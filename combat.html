<html><script src="https://cdn.jsdelivr.net/npm/@jcubic/lips@beta/dist/lips.min.js"></script><script src="https://pixijs.download/release/pixi.js"></script><script type="text/x-scheme"  bootstrap>


(define obj &(:backgroundColor "0x1099bb"))
(define app (new PIXI.Application obj)) 

(define info
"

server
load: 0% 

")

(define game-state
  '( (server ("Mallard" 150 150)
	     ("Dabbling" 300 300))))
(let ((call-backs '()))

(define (draw-connection x0 y0 x1 y1)
  1)

(define (draw-server args)
  (let ((x (car (cdr args)))
	(y (car (cdr (cdr args))))
	(graphics (new PIXI.Graphics))
	(text (new PIXI.Text (car args))) 
	(container (new PIXI.Container))
	(halfCircle (new PIXI.Graphics))
	(rectangle (new PIXI.Graphics))
	(phase 0))
    
    (halfCircle.beginFill "0xff0000")
    (halfCircle.lineStyle 2 "0xffffff")
    (halfCircle.arc 0 0 100 0 Math.PI)
    (halfCircle.endFill)
    (halfCircle.position.set 50 50)
    
    (rectangle.lineStyle 2 "0xffffff" 1)
    (rectangle.drawRoundedRect 0 0 100 100 16)
    (rectangle.endFill)
    (set! rectangle.mask halfCircle)
    (container.addChild rectangle)
    (container.addChild halfCircle)
    
    (set! text.x x)
    (set! text.y (- y 50))
    (app.stage.addChild text)
    (set! container.position (new PIXI.Point x y))
    (app.stage.addChild container)
    (set! call-backs (cons call-backs (lambda () (set! text.text "foo"))))
    (lambda (delta)
      (set! phase (+ phase (/ delta 6)))
      (set! phase (% phase (* Math.PI 2)))
      (set! halfCircle.rotation phase))))


(document.body.appendChild app.view)

;;(define servCB (drawServer 350 150))
;;(define servTwoAB (drawServer 150 300))

(define servers (cdr (car game-state)))
(define graphics (map draw-server servers))
(map app.ticker.add graphics)
;;(console.log (map cdr (cdr (car game-state))))
;;(app.ticker.add (lambda (delta)
;;		  (servTwoAB delta)
;;		  (servCB delta)))
		
;;(console.log game-state)
(set! window.callbacks call-backs))
</script>

</html>
